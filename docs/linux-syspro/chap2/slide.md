---
marp: true
theme: gaia

---

<style>
{
font-size: 22px;
}
</style>

# 1章 ファイルI/O


-　本章ではファイルI/O の基本について述べます。ファイルI/O はUnix システムの中核をなすものです。
- さらに次章では標準C ライブラリの標準入出力について、また「4 章　高度なファイルI/O」ではより高度な処理や特殊なファイルI/O インタフェースへと範囲を拡げ、解説します。「7 章　ファイル、ディレクトリの管理」でもファイル/ ディレクトリ操作について議論します。
- ファイルを読み書きする前にはオープンする必要があります。カーネルはオープンしたファイルをプロセスごとに管理しており、これをプロセスのファイルテーブル（file table）と言います。
- ファイルテーブル内のエントリは非負の整数、ファイルディスクリプタ（ファイル記述子、file descriptor。一般にfdまたはfdsと略されます）により順番に管理されており、オープンしたファイルに関する状態を保持します。
- メモリinode（ファイルに対応するディスク上のinodeをメモリ上へコピーしたもの）や、ファイルポジション（読み書きす
るファイル内のオフセット）、アクセスモードなどのメタデータです。ユーザ空間、カーネル空間のどちら
からも、ファイルディスクリプタはプロセスごとの一意なcookieとして使用されます。ファイルをオープン
するとファイルディスクリプタが返され、以降の処理（読み書きなど）ではファイルディスクリプタが中心的
なパラメータになります。
　デフォルトでは、子プロセスは親プロセスのファイルテーブルを受け継ぎます。オープンしたファイルは
付随情報（アクセスモード、ファイルポジションなど）とともにすべて受け継がれますが、例えば子プロセス
がファイルを1つクローズしたなど、どちらかのプロセスがファイルテーブルを変更しても、他のプロセス
のファイルテーブルは影響を受けません。しかし、「5章　プロセス管理」でも述べますが、親子プロセス間
でファイルテーブルを共有することも可能です（スレッドはファイルテーブルを共有します）。
　ファイルディスクリプタはC 言語のint 型で表現され、fd_t のような専用の型は使用しません。専用の
型はおかしなものとする考え方も多いのですが、歴史的にはUnix流と言えます。Linuxのプロセスではオー
プン可能なファイル数に上限が設けられています。ファイルディスクリプタの値は、0 から上限よりも1 少
ない値までの範囲を採ります。デフォルトではオープン可能なファイル数の上限は1,024とされていますが、
1,048,576まで拡張可能です。負数はファイルディスクリプタに使用できませんので、ファイルディスクリプ
タを返す関数のエラーを表す場合に、戻り値として-1 を使用するのが一般的です。
　明示的にクローズしない限り、すべてのプロセスは少なくとも3つのオープン済みファイルディスクリプ
タを持っています。0、1、2です。ファイルディスクリプタ0は標準入力（standard in、stdin）を、1は標準
出力（standard out、stdout）を、2は標準エラー出力（standard error、stderr）を、それぞれ表します。上記